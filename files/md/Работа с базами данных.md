### Установка соединения

![screenshot](https://docs.streamlit.io/images/api/connection.svg)

```python
соединение = st.connection('база_данных', type='sql')
таблица = соединение.query('select * from таблица_базы_данных')
st.dataframe(таблица)
```

> Примечание - В коде выше представлен пример взаимодействия (API) между элементами программного кода с помощью `st.connection`.

## Функция `st.connection`

Создаёт новое соединение с хранилищем данных.

Параметры конфигурации, учетные данные и пароли для подключения к базе данных можно получить:

- с помощью аргументов функции `st.connection()`;
- с применением файла `secrets.toml`;
- через файлы конфигурации, специфичные для конкретного соединения.

Соединение, возвращаемое из `st.connection`, кэшируется с помощью `st.cache_resource` и поддерживается только для конкретного пользователя приложения, не предоставляя доступ другим пользователям клиент-серверного приложения.

### `st.connection(name, type=None, max_entries=None, ttl=None, **kwargs)`



| Параметры                                | Описание                                                     |
| ---------------------------------------- | ------------------------------------------------------------ |
| name *(str)*                             | Имя соединения, используемое для поиска настроек в файле `secrets.toml`. Streamlit производит поиск настроек соединения в разделе [`connections.<name>`]. Тип соединеия может быть предопределён, если следующему аргументу (`type`) присвоено одно из значений: "snowflake", "snowpark" или "sql". |
| type *(str, connection class, или None)* | Тип создаваемого соединения. Может быть одим из следующих значений: `None` (по умолчанию): Streamlit выводит тип соединения из имени. Если тип не выводится из имени, его необходимо указать в файле secrets.toml. `"snowflake"`: Streamlit инициализирует соединение с SnowflakeConnection. `"snowpark"`: Streamlit инициализирует соединение с SnowparkConnection. Это устарело. `"sql"`: Streamlit инициализирует соединение с SQLConnection.Строка пути к импортируемому классу: Это должен быть разделенный точками путь к модулю, заканчивающийся на импортируемый класс. Streamlit импортирует класс и инициализирует соединение с ним. Класс должен расширять `st.connections.BaseConnection`.Ссылка на импортируемый класс: Streamlit инициализирует соединение с классом, на который ссылается, который должен расширять `st.connections.BaseConnection`. |
| max_entries *(int or None)*              | Максимальное количество соединений, которое должно храниться в кэше. Если это значение равно `None` (по умолчанию), кэш будет неограниченным. В противном случае, когда в заполненный кэш добавляется новая запись, самая старая запись из кэша удаляется. |
| ttl *(float, timedelta, or None)*        | Максимальное количество секунд, в течение которого результаты будут храниться в кэше. Если это значение равно `None` (по умолчанию), кэшированные результаты не теряют своей актуальности. |
| **kwargs *(any)*                         | Аргументы ключевых слов, специфичные для соединения, которые передаются в метод ._connect() соединения. **kwargs обычно сочетаются с парами ключ-значение в файле secrets.toml (и имеют преимущественную силу перед ними). Чтобы узнать больше, обратитесь к документации по конкретному соединению. |
| Возврат                                  |                                                              |
| *(Subclass of BaseConnection)*           | Инициализированный объект соединения указанного типа.        |

### Примеры
#### Пример1: Назначенный тип соединения
Самый простой способ создать соединение (SQL, Snowflake или Snowpark) - это использовать их имена по умолчанию и определить их в соответствующих секциях файла `secrets.toml`. В следующем примере создается соединение типа "sql".

В файле `.streamlit/secrets.toml` создаётся следующий раздел:

```toml
[connections.sql]
dialect = "xxx"
host = "xxx"
username = "xxx"
password = "xxx"
```

Для его использования в коде программы создаётся объект соединения:

```python
import streamlit as st
объект_соединения = st.connection("sql")
```

#### Пример 2: Именованное соединение

Создание соединения с пользовательским именем требует явного указания типа. Если тип не передан в качестве аргумента `type`, он должен быть задан в соответствующем разделе файла `secrets.toml`. В следующем примере создаются два соединения типа "sql", каждое со своим собственным именем. В первом случае тип задается в команде `st.connection`, во втором - в `secrets.toml`.

`.streamlit/secrets.toml`:

```toml
[connections.first_connection]
dialect = "xxx"
host = "xxx"
username = "xxx"
password = "xxx"
 
[connections.second_connection]
type = "sql"
dialect = "yyy"
host = "yyy"
username = "yyy"
password = "yyy"
```

Фрагмент кода основной программы:

```python
import streamlit as st
...
соежинение_1 = st.connection("first_connection", type="sql")
соединение_2 = st.connection("second_connection")
...
```

#### Пример 3: Использование пути к классу соединения

Передача полного пути к базе данных может быть полезной, особенно при работе с удалённой базой данных. Хотя это не типичный способ, следующий пример определяет взаимодействие того же типа, что и соединение с `type="sql"`. Обратите внимание, что `type` - это строковый путь.

`.streamlit/secrets.toml`:

```toml
[connections.my_sql_connection]
url = "xxx+xxx://xxx:xxx@xxx:xxx/xxx"
```
 
Фрагмент кода основной программы:

```python
import streamlit as st
...
conn = st.connection(
    "my_sql_connection", type="streamlit.connections.SQLConnection"
    )
...
```

#### Пример 4: Импортирование класса соединения

Вы можете передать класс соединения непосредственно в команду `st.connection`. Это позволит инструментам статической проверки типов, таким как `mypy`, вывести необходимый возвращаемый тип `st.connection`. В следующем примере создается такое же соединение, как и в примере 3.

`.streamlit/secrets.toml`:

```toml
[connections.my_sql_connection]
url = "xxx+xxx://xxx:xxx@xxx:xxx/xxx"
```
 
Фрагмент программного кода:

```python
import streamlit as st
from streamlit.connections import SQLConnection
соединение = st.connection("my_sql_connection", type=SQLConnection)
```

Чтобы получить исчерпывающее представление об этой функции, ознакомьтесь с видеоуроком Джошуа Кэрролла, менеджера по продуктам Streamlit для разработчиков. На реальных примерах вы узнаете о пользе этой функции для создания и управления соединениями данных в ваших приложениях: https://youtu.be/xQwDfW7UHMo?list=TLGGAxN0dA-LUZ8xMTEyMjAyNA

